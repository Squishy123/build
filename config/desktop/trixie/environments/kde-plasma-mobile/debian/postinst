# overwrite stock lightdm greeter configuration
 #if [ -d /etc/armbian/lightdm ]; then cp -R /etc/armbian/lightdm /etc/; fi
#if [ -f /etc/lightdm/slick-greeter.conf ]; then sed -i 's/armbian03-Dre0x-Minum-dark-blurred-3840x2160.jpg/armbian-4k-black-psycho-gauss.jpg/g' /etc/lightdm/slick-greeter.conf; fi

# Disable Pulseaudio timer scheduling which does not work with sndhdmi driver
if [ -f /etc/pulse/default.pa ]; then sed "s/load-module module-udev-detect$/& tsched=0/g" -i  /etc/pulse/default.pa; fi

# enable pulse audio
systemctl --user enable pulseaudio
systemctl --user restart pulseaudio

# Create setup to rotate internal screen and touchscreen @TODO MOVE TO DEVICE SPECIFIC e.g. odin2-grub
sudo mkdir -p /usr/share/sddm/scripts
sudo cat <<- EOF > /usr/share/sddm/scripts/Xsetup
TOUCHSCREEN_ID=$(xinput list --short 2>&1 | grep -oP 'xwayland-touch:\K[0-9]+')

xrandr --output DSI-1 --rotate right --mode 1920x1080
xinput set-prop $TOUCHSCREEN_ID 'Coordinate Transformation Matrix' 1 0 0 0 1 0 0 0 1
EOF


#configure sddm
sudo mkdir -p /etc/sddm.conf.d
sudo cat <<- EOF > /etc/sddm.conf.d/armbian.conf
	[Theme]
	Current=breeze
	[General]
	InputMethod=qtvirtualkeyboard
	[X11]
	DisplayCommand=/usr/share/sddm/scripts/Xsetup
	[Wayland]
	CompositorCommand=weston --shell=kiosk # @TODO figure out how to rotate with weston and wayland
EOF
